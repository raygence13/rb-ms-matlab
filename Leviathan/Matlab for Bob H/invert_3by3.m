function B = invert_3by3(A)
%
% invert a 3 by 3 matrix without using Matlab functions
%
%% 3x3 Determinant
d = A(1,1)*A(2,2)*A(3,3) + A(1,2)*A(2,3)*A(3,1) + A(1,3)*A(2,1)*A(3,2) - ...
    A(1,3)*A(2,2)*A(3,1) - A(1,1)*A(2,3)*A(3,2) - A(1,2)*A(2,1)*A(3,3);

%% Cofactors
c11 = A(2,2)*A(3,3) - A(2,3)*A(3,2);
c12 = -(A(2,1)*A(3,3) - A(2,3)*A(3,1));
c13 = A(2,1)*A(3,2) - A(2,2)*A(3,1);
c21 = -(A(1,2)*A(3,3) - A(1,3)*A(3,2));
c22 = A(1,1)*A(3,3) - A(1,3)*A(3,1);
c23 = -(A(1,1)*A(3,2) - A(1,2)*A(3,1));
c31 = A(1,2)*A(2,3) - A(1,3)*A(2,2);
c32 = -(A(1,1)*A(2,3) - A(1,3)*A(2,1));
c33 = A(1,1)*A(2,2) - A(1,2)*A(2,1);

%% Inverse
B = NaN*zeros(3,3);
B(1,1) = c11/d;
B(1,2) = c21/d;
B(1,3) = c31/d;
B(2,1) = c12/d;
B(2,2) = c22/d;
B(2,3) = c32/d;
B(3,1) = c13/d;
B(3,2) = c23/d;
B(3,3) = c33/d;



